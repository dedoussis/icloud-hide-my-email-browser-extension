# Codex Agent Guide

## Project Snapshot

- **Purpose:** Cross-browser extension that surfaces iCloud Hide My Email workflows in Chromium- and Firefox-based browsers.
- **Core UX:** Background service worker coordinates with iCloud, content scripts augment email inputs, popup/options React apps manage aliases and settings.
- **Primary Dependencies:** TypeScript 5, React 19, Tailwind CSS 4, webpack 5, `webextension-polyfill`, Font Awesome icon packs, Fuse.js for search.

## Repository Layout

- `src/` core extension code. Notable modules:
  - `pages/` React entry points for `Background`, `Content`, `Options`, `Popup`, and `Userguide` bundles.
  - `browserUtils.ts` shared helpers for browser/runtime detection.
  - `hooks.ts` reusable React hooks.
  - `commonComponents.tsx` shared UI primitives.
  - `iCloudClient.ts` API client handling iCloud requests.
  - `storage.ts` wrapper around extension storage APIs.
  - `messages.ts`, `options.ts`, `rules.json`, and `manifest.json` describe messaging, option defaults, declarative rules, and extension metadata.
- `assets/` static images, icons, and demo GIFs packaged with the build.
- `utils/` node scripts that drive bundling (`build.js`) and the development web server (`webserver.js`).
- `build/` output directory regenerated by the build scripts; safe to delete between runs.
- Root configs: `webpack.config.js`, `tailwind.config.js`, `postcss.config.js`, `tsconfig.json`, and `eslint.config.mjs` control bundling, styling, TypeScript, and linting.

## Tooling & Environment

- Target Node.js 22 LTS.
- TypeScript compiler runs in strict mode with JSX transpiled via webpack + `ts-loader`.
- Styling is authored with Tailwind CSS utilities; global CSS lives beside each page entry (`index.css`).
- Webpack builds multiple entry points and relies on `webextension-polyfill` for cross-browser APIs.

## Commands

Run all commands from the repository root.

- Install dependencies: `npm install` (CI uses `npm ci`).
- Chromium development: `npm run start` then load `build/` as an unpacked extension.
- Firefox development: `npm run start:firefox` (requires `web-ext`; automatically launches a Firefox profile).
- Production builds: `npm run build` (Chromium) or `npm run build:firefox` (sets `FIREFOX=true`). Both clean `build/` beforehand.
- Lint: `npm run lint` (ESLint over TypeScript/React sources).
- Formatting: `npm run prettier:check` to verify, `npm run prettier` to apply.

## Coding Conventions

- Language: TypeScript with React function components; keep modules typed and avoid `any`.
- Structure React components per page; share logic via `hooks.ts` or `commonComponents.tsx` instead of cross-importing page-specific files.
- Styling: prefer Tailwind utility classes; fall back to scoped CSS files when necessary.
- Formatting matches Prettier defaults in the repo: 2-space indentation, single quotes, trailing commas in multiline literals.
- Respect existing manifest constraints (MV3) and ensure background logic remains service-worker friendly.
- When touching storage or network logic, verify compatibility with both Chromium and Firefox runtimes.

## Testing & QA Expectations

- No automated tests ship today; run `npm run build` (and `npm run build:firefox` when relevant) before shipping.
- Manually smoke test critical flows: generating aliases, searching existing aliases (Fuse.js-based search), toggling context menu/autofill settings, and ensuring popup/options render correctly.
- Capture manual test notes and browser versions when preparing PRs.

## Contribution Notes

- Follow conventional commit prefixes (`feat:`, `fix:`, `chore:`) used in history.
- Group related changes and keep refactors scoped to the affected module.
- Lint and formatter checks should pass prior to submitting changes.
- When UI changes affect Popup, Options, or Userguide pages, provide updated screenshots or GIFs mirroring those under `src/assets/img`.
